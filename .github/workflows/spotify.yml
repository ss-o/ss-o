---
name: "ðŸŒ€ SPOTIFY"
on:
  schedule:
    - cron: "20 20 * * */2"
  push:
    branches: [main]
    paths: [.github/workflows/spotify.yml]
  workflow_dispatch: {}

env:
  recent_svg: "metrics/plugin/music/spotify/recent.svg"
  top_tracks_svg: "metrics/plugin/music/spotify/top-tracks.svg"
  top_artists_svg: "metrics/plugin/music/spotify/top-artists.svg"
  playlist_lofi: "https://open.spotify.com/embed/playlist/31FWVQBp3WQydWLNhO0ACi"
  playlist_lofi_svg: "metrics/plugin/music/spotify/lofi.svg"
  playlist_east: "https://open.spotify.com/embed/playlist/1X0xAsHWCpamURi0SJqV3w"
  playlist_east_svg: "metrics/plugin/music/spotify/east.svg"
  playlist_west: "https://open.spotify.com/embed/playlist/2MvEUsMh1eGSrezcirrXFd"
  playlist_west_svg: "metrics/plugin/music/spotify/west.svg"

jobs:
  spotify-metrics-1:
    environment: metrics
    runs-on: ubuntu-latest
    timeout-minutes: 30
    concurrency:
      group: ci-1-${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    if: github.repository == 'ss-o/ss-o'      
    steps:
      - uses: actions/checkout@v3
      - uses: lowlighter/metrics@520ff377142700a2e98fb3ee39798b6b8c43fe98
        with:
          filename: ${{ env.playlist_west_svg }}
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_mode: playlist
          plugin_music_provider: spotify
          plugin_music_playlist: ${{ env.playlist_west }}
          plugin_music_limit: 2
      - uses: lowlighter/metrics@520ff377142700a2e98fb3ee39798b6b8c43fe98
        with:
          filename: ${{ env.playlist_lofi_svg }}
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_mode: playlist
          plugin_music_provider: spotify
          plugin_music_playlist: ${{ env.playlist_lofi }}
          plugin_music_limit: 2
  spotify-metrics-2:
    environment: metrics
    runs-on: ubuntu-latest
    timeout-minutes: 30
    concurrency:
      group: ci-2-${{ github.workflow }}-${{ github.ref }}
      cancel-in-progress: true
    steps:
      - uses: actions/checkout@v3
      - uses: lowlighter/metrics@520ff377142700a2e98fb3ee39798b6b8c43fe98
        with:
          filename: ${{ env.recent_svg }}
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_provider: spotify
          plugin_music_mode: recent
          plugin_music_played_at: false
          plugin_music_time_range: short
          plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
          plugin_music_limit: 2
      - uses: lowlighter/metrics@520ff377142700a2e98fb3ee39798b6b8c43fe98
        with:
          filename: ${{ env.top_tracks_svg }}
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_mode: top
          plugin_music_provider: spotify
          plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
          plugin_music_time_range: short
          plugin_music_top_type: tracks
          plugin_music_limit: 2
      - uses: lowlighter/metrics@520ff377142700a2e98fb3ee39798b6b8c43fe98
        with:
          filename: ${{ env.top_artists_svg }}
          token: NOT_NEEDED
          base: ""
          plugin_music: yes
          plugin_music_mode: top
          plugin_music_provider: spotify
          plugin_music_token: ${{ secrets.SPOTIFY_TOKENS }}
          plugin_music_time_range: long
          plugin_music_top_type: artists
          plugin_music_limit: 2
